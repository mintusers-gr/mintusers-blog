#!/usr/bin/env bash
set -e

if [ ! -d /vagrant ]
then
  echo "$(tput setaf 6)*************************************************$(tput sgr0)"
  echo "$(tput setaf 6)*   Please run Jekyll only inside guest         *$(tput sgr0)"
  echo "$(tput setaf 6)*************************************************$(tput sgr0)"
  exit
fi

source /vagrant/.env
/vagrant/bin/check-config
cd /vagrant

# Kill everything that use port 4000
set +e
fuser -k 4000/tcp
set -e

echo -e "$(tput setaf 5)*************************************************$(tput sgr0)"
echo -e "$(tput setaf 5)*           Running Jekyll                      *$(tput sgr0)"
echo -e "$(tput setaf 5)*************************************************$(tput sgr0)"
echo -e "$(tput setaf 6)The webservice URL is:\n   http://${BOX_HOSTNAME}:4000$(tput sgr0)\n"

# We use a plugin so no need for --force_polling
LISTEN_GEM_DEBUGGING=1 bin/jekyll serve  --watch \
    --livereload \
    --host 0.0.0.0
